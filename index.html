<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OneViannay Rewards - Tier List</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a202c">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">

    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen p-4 sm:p-6 md:p-8">

    <div id="app-container" class="max-w-7xl mx-auto">
        <header class="flex flex-col xl:flex-row justify-between items-center mb-6 gap-4">
            <h1 id="tierlist-title" contenteditable="true" class="text-3xl sm:text-4xl font-bold cursor-pointer hover:bg-gray-700 px-2 rounded text-center xl:text-left text-blue-400 border-b-2 border-blue-500 w-full xl:w-auto">
                Anime OneViannay Rewards
            </h1>
            
            <div class="flex items-center gap-2 flex-wrap justify-center xl:justify-end w-full xl:w-auto">
                <button id="import-template-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-transform hover:scale-105" title="Importar Template (JSON)">
                    <i class="fas fa-file-import md:mr-2"></i><span class="hidden md:inline">Importar</span>
                </button>
                <button id="export-template-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-transform hover:scale-105" title="Exportar Template (JSON)">
                    <i class="fas fa-file-export md:mr-2"></i><span class="hidden md:inline">Template</span>
                </button>
                <button id="export-cards-btn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-transform hover:scale-105" title="Baixar Cards (PNG)">
                    <i class="fas fa-th md:mr-2"></i><span class="hidden md:inline">Cards</span>
                </button>
                <button id="manage-lists-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-transform hover:scale-105">
                    <i class="fas fa-list-ul md:mr-2"></i><span class="hidden md:inline">Listas</span>
                </button>
                <button id="export-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-transform hover:scale-105">
                    <i class="fas fa-camera md:mr-2"></i><span class="hidden md:inline">Exportar Imagem</span>
                </button>
                <input type="file" id="import-json-input" accept=".json" class="hidden">
            </div>
        </header>

        <div class="flex flex-col md:flex-row md:gap-6 lg:gap-8">
            
            <main id="tierlist-content" class="bg-gray-800 p-4 rounded-lg shadow-2xl flex-grow">
                <div id="tiers-container" class="flex flex-col gap-1"></div>
                <div class="mt-4">
                    <button id="add-tier-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Nova Tier
                    </button>
                </div>
            </main>

            <section class="mt-8 md:mt-0 md:w-80 lg:w-96 md:flex-shrink-0 bg-gray-800 p-4 rounded-lg shadow-2xl flex flex-col">
                <h2 class="text-2xl font-bold mb-4 border-b-2 border-gray-700 pb-2">Banco de Imagens</h2>
                
                <div class="mb-4 flex-shrink-0 flex flex-col gap-3">
                    <div class="flex gap-2">
                        <input type="text" id="image-url-input" placeholder="Cole o URL da imagem" class="flex-grow bg-gray-700 text-white rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                        <button id="add-image-url-btn" title="Adicionar por URL" class="bg-purple-600 hover:bg-purple-700 text-white font-bold p-3 rounded-md transition-colors"><i class="fas fa-link"></i></button>
                    </div>
                    <input type="file" id="image-upload-input" accept="image/*" multiple class="hidden">
                    <button id="add-image-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-transform hover:scale-105">
                        <i class="fas fa-upload"></i>Adicionar do PC
                    </button>
                </div>

                <div id="image-bank-dropzone" class="min-h-[120px] flex-grow bg-gray-900/50 p-3 rounded-lg flex flex-wrap content-start gap-3 border-2 border-transparent transition-all duration-300 overflow-y-auto">
                    </div>
            </section>
        </div>
    </div>

    <div id="manage-lists-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-blue-400">Gerenciar Listas</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <h3 class="font-semibold text-gray-300 mb-2">Criar Nova Lista</h3>
                    <div class="flex gap-2">
                        <input type="text" id="new-list-name-input" placeholder="Nome da nova lista" class="flex-grow bg-gray-700 text-white rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500">
                        <button id="create-new-list-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Criar</button>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-300 mb-2">Minhas Listas Salvas</h3>
                    <div id="tierlists-selection-container" class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="image-details-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-lg border border-gray-700">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-2xl font-bold text-blue-400"><i class="fas fa-chart-pie mr-2"></i>Estatísticas do Item</h2>
                <button id="close-details-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <div class="w-full sm:w-1/3 flex justify-center items-start">
                    <img id="detail-preview-img" src="" class="w-32 h-32 object-cover rounded-lg shadow-md border-2 border-gray-600">
                </div>
                <div class="w-full sm:w-2/3 space-y-3">
                    <div>
                        <label class="block text-xs text-gray-400 uppercase font-bold mb-1">Nome</label>
                        <input type="text" id="detail-name" placeholder="Ex: Naruto Shippuden" class="w-full bg-gray-700 text-white rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="flex gap-4">
                        <div class="w-1/2">
                            <label class="block text-xs text-gray-400 uppercase font-bold mb-1">Nota (0 a 10)</label>
                            <input type="number" id="detail-rating" min="0" max="10" step="0.1" placeholder="9.5" class="w-full bg-gray-700 text-white rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none font-mono text-lg">
                        </div>
                        <div class="w-1/2">
                            <label class="block text-xs text-gray-400 uppercase font-bold mb-1">Mudança de Posição</label>
                            <input type="number" id="detail-position" placeholder="Ex: 2 ou -1" class="w-full bg-gray-700 text-white rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none font-mono text-lg">
                            <span class="text-[10px] text-gray-500">Use (+) p/ subir, (-) p/ cair.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-xs text-gray-400 uppercase font-bold mb-1">Descrição / Análise</label>
                <textarea id="detail-desc" rows="3" placeholder="Sua análise ou observações sobre este item..." class="w-full bg-gray-700 text-white rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none resize-none"></textarea>
            </div>
            
            <div class="flex justify-end gap-2 mt-6">
                <button id="save-details-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg w-full sm:w-auto">
                    <i class="fas fa-save mr-2"></i>Salvar Dados
                </button>
            </div>
        </div>
    </div>
    
    <div id="loading-spinner" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 flex-col px-4 transition-opacity duration-300">
        <div class="w-16 h-16 border-4 border-t-blue-500 border-gray-600 rounded-full animate-spin mb-4"></div>
        <p id="loading-text" class="text-white font-semibold text-center mb-2">Processando imagem...</p>
        <div class="w-full max-w-xs bg-gray-700 rounded-full h-2.5 overflow-hidden">
            <div id="loading-progress" class="bg-blue-500 h-2.5 rounded-full transition-all duration-200" style="width: 0%"></div>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => {
                    console.log('PWA OneViannay Registrado com Sucesso!', reg.scope);
                }).catch(err => {
                    console.log('Falha ao registrar o PWA:', err);
                });
            });
        }
    </script>
</body>
</html>